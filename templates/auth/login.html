{% extends 'base.html' %}

{% block content %}
<div
    class="min-h-screen flex items-center justify-center p-4 bg-[url('https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-gradient-to-br from-teal-900/80 via-teal-800/80 to-black/60 backdrop-blur-sm"></div>

    <div class="relative w-full max-w-md">
        <!-- Brand -->
        <div class="flex justify-center mb-8">
            <div class="flex items-center gap-3 text-white">
                <div class="bg-white/20 p-2.5 rounded-xl backdrop-blur-md">
                    <i data-lucide="sprout" class="size-8"></i>
                </div>
                <span class="text-3xl font-bold tracking-tight">GeneraLink</span>
            </div>
        </div>

        <!-- Glass Card -->
        <div class="glass rounded-3xl p-1 shadow-2xl overflow-hidden">
            <div class="bg-white/80 backdrop-blur-xl p-8 rounded-[20px]">
                <h2 class="text-2xl font-bold text-center mb-2 text-gray-900">Welcome Back!</h2>
                <p class="text-center text-gray-500 mb-8">Sign in to continue connecting.</p>

                <form id="login-form" class="space-y-5">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1.5 ml-1">Email</label>
                        <div class="relative">
                            <i data-lucide="mail"
                                class="absolute left-4 top-1/2 -translate-y-1/2 size-5 text-gray-400"></i>
                            <input type="email" id="email"
                                class="w-full pl-12 pr-4 py-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all outline-none"
                                placeholder="you@example.com" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1.5 ml-1">Password</label>
                        <div class="relative">
                            <i data-lucide="lock"
                                class="absolute left-4 top-1/2 -translate-y-1/2 size-5 text-gray-400"></i>
                            <input type="password" id="password"
                                class="w-full pl-12 pr-4 py-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all outline-none"
                                placeholder="••••••••" required>
                        </div>
                    </div>

                    <div class="flex items-center justify-between text-sm px-1">
                        <label class="flex items-center gap-2 cursor-pointer text-gray-600 select-none">
                            <input type="checkbox"
                                class="w-4 h-4 rounded text-primary border-gray-300 focus:ring-primary">
                            Remember me
                        </label>
                        <a href="/reset-password"
                            class="text-primary font-semibold hover:text-teal-700 transition-colors">Forgot
                            password?</a>
                    </div>

                    <button type="submit" id="btn-submit"
                        class="w-full py-3.5 bg-gradient-to-r from-primary to-teal-600 text-white rounded-xl font-bold text-lg shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2">
                        Sign In <i data-lucide="arrow-right" class="size-5"></i>
                    </button>
                </form>

                <div class="mt-8 text-center">
                    <p class="text-gray-600">Don't have an account? <a href="/signup"
                            class="text-primary font-bold hover:underline">Create one</a></p>
                </div>
            </div>
        </div>

        <p class="text-center text-white/40 text-sm mt-8">© 2024 GeneraLink. All rights reserved.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btn-submit');
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        btn.disabled = true;
        btn.innerHTML = '<i class="animate-spin" data-lucide="loader-2"></i> Signing in...';
        lucide.createIcons();

        try {
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();

            if (data.success) {
                localStorage.setItem('user', JSON.stringify(data.user));
                showToast('Welcome back!', 'success');
                setTimeout(() => window.location.href = '/matching', 1000);
            } else {
                showToast(data.error || 'Login failed', 'error');
                btn.disabled = false;
                btn.innerHTML = 'Sign In <i data-lucide="arrow-right" class="size-5"></i>';
                lucide.createIcons();
            }
        } catch (e) {
            showToast('Connection error', 'error');
            btn.disabled = false;
            btn.innerHTML = 'Sign In <i data-lucide="arrow-right" class="size-5"></i>';
            lucide.createIcons();
        }
    });
</script>
{% endblock %}